<!DOCTYPE html>
<html>
<html lang="en">
    <meta charset="utf-8"/>
    <title> Counterintuitive yet Unique Brainfuck Engine </title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" type="text/css" href="tln.min.css"/>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,400i,700,700i|Roboto:400,400i,700,700i" rel="stylesheet">
    <style type="text/css">
        * {
            margin: 0;
            border: 0;
            padding: 0;
            outline: 0;
            box-sizing: border-box;
            vertical-align: middle;
            list-style: none;
        }
        html, body {
            font-family: "Roboto", sans-serif;
            background-color: #efefef;
            overflow: hidden;
            width: 100%;
            height: 100%;
            min-width: 100%;
            min-height: 100%;
        }
        main {
            height: 100%;
        }
        .part {
            display: block;
            padding: 30px;
            text-align: center;
        }
        #sample-code {
            width: 100%;
            padding: 15px 10px 10px;
            font-family: "Roboto Mono", monospace;
            border: 1px solid #aeaeae;
            height: 100%;
            background-color: #fff;
        }
        .clickable {
            cursor: pointer;
            user-select: none;
            border-radius: 1px;
            font-family: "Roboto", sans-serif;
            font-size: 16px;
            padding: 10px 20px;
            background-color: #b0ccff;
            box-shadow: 0 3px 0 cornflowerblue;
            transition: all .1s ease;
            margin: 5px;
        }
        .clickable:active {
            transform: translateY(3px);
            box-shadow: 0 0px 0 cornflowerblue;
        }
        #run {
            margin: .5px;
        }
        #status {
            font-size: 16px;
            font-family: "Roboto Mono", monospace;
            white-space: pre;
            padding: 15px;
            background-color: #cce;
            color: #333;
            height: 50px
        }
        #tabs {
            padding: 0;
            font-size: 0;
            text-align: left;
            height: calc(100% - 150px);
        }
        #tabs [data-tab]:first-child {
            margin-left: 48px;
        }
        #tabs [data-tab] {
            cursor: default;
            padding-left: 10px;
            border: 1px solid #aeaeae;
            display: inline-block;
            font-family: "Roboto Mono", monospace;
            width: 150px;
            color: #666;
            font-size: 16px;
            height: 50px;
            line-height: 50px;
            user-select: none;
            background-color: #f6f6f6;
            transform: translateY(1px);
            position: relative;
        }
        #tabs [data-tab]:not([data-id="4"]) {
            border-right: 0;
        }
        #tabs [data-tab].selected {
            border-bottom: 0;
            color: #333;
            background-color: #fff;
        }
        [data-id] ~ [data-id], #dl-guide {
            display: none;
        }
        [data-id] ~ [data-id] {
            height: calc(100% - 50px);
        }
        [data-id="1"].selected ~ [data-id="1"],
        [data-id="2"].selected ~ [data-id="2"],
        [data-id="3"].selected ~ [data-id="3"],
        [data-id="4"].selected ~ [data-id="4"] {
            display: block;
        }
        [data-id]:not(.selected) .download {
            pointer-events: none;
            opacity: .3;
        }
        .download {
            position: absolute;
            right: 10px;
            top: 13px;
            fill: #aeaeae;
            cursor: pointer;
            width: 24px;
        }
        .download:hover {
            fill: #333;
        }
        #docs {
            overflow-y: auto;
            text-align: left;
            font-family: "Roboto", sans-serif;
            background-color: #fff;
            padding: 15px;
            border-top: 1px solid #aeaeae;
            height: calc(100% - 50px);
        }
        #docs p, #docs pre, #docs code {
            font-size: 16px;
        }
        #docs h2 {
            margin: 20px 0 10px;
            font-size: 23px;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
        }
        #docs pre, #docs code {
            font-family: "Robot Mono", monospace;
            padding: 2px;
            background-color: #eee;
        }
        #docs pre {
            margin: 10px;
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <svg id="dl-guide" viewBox="0 0 24 24">
        <defs>
            <path id="dl" d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z" />
        </defs>
    </svg>
    <main>
        <section class="part">
            <button id="run" class="clickable"> Run </button>
        </section>
        <div id="status"> Welcome to CUBE, the Counterintuitive yet Unique Brainfuck Engine </div>
        <section id="tabs" class="part">
            <div data-tab onclick="change_tab(this);" data-id="1" class="selected">
                load.bf
                <svg class="download" viewBox="0 0 24 24" onclick="download_file('load-code','load.bf');">
                    <use xlink:href="#dl"/>
                </svg>
            </div>
            <div data-tab onclick="change_tab(this);" data-id="2">
                update.bf
                <svg class="download" viewBox="0 0 24 24" onclick="download_file('update-code','update.bf');">
                    <use xlink:href="#dl"/>
                </svg>
            </div>
            <div data-tab onclick="change_tab(this);" data-id="3"> cheatsheet </div>
            <div data-tab onclick="change_tab(this);" data-id="4"> sample codes </div>
            <!-- -->
            <div data-id="1">
                <textarea
                    id="load-code"
                    class="codearea"
                    spellcheck="false"
                    placeholder="load.bf&#10;&#10;Code to be run upon startup.&#10;Runs only once."
                ></textarea>
            </div>
            <div data-id="2">
                <textarea
                    id="update-code"
                    class="codearea"
                    spellcheck="false"
                    placeholder="update.bf&#10;&#10;Code to be run during the game.&#10;Runs on every frame."
                ></textarea>
            </div>
            <section id="docs" class="part" data-id="3">
                <h2> Input (<code>,</code>) </h2>
<pre>0 = Left arrow             => (0 = unpressed, 1 = pressed)
1 = Up arrow               => (0 = unpressed, 1 = pressed)
2 = Right arrow            => (0 = unpressed, 1 = pressed)
3 = Down arrow             => (0 = unpressed, 1 = pressed)
4 = 'A' key                => (0 = unpressed, 1 = pressed)
5 = 'S' key                => (0 = unpressed, 1 = pressed)
6 = X coordinate of mouse  => (0 to 24)
7 = Y coordinate of mouse  => (0 to 18)
8 = Mouse click            => (0 = unpressed, 1 = pressed)</pre>
                <h2> Output (<code>.</code>)</h2>
<pre>0 = No change (shows the background color)
1 = Black (#333)
2 = Gray  (#ccc)
3 = White (#fff)
4 = Red   (#c33)
5 = Green (#3c3)
6 = Blue  (#33c)</pre>
            </section>
            <section id="sample-code" class="part" data-id="4"></section>
        </section>
    </main>
    <script type="text/javascript" src="tln.min.js"></script>
    <script type="text/javascript">
        append_line_numbers("load-code");
        append_line_numbers("update-code");

        let tape = new Uint8Array(1e4);
        let load_code = document.getElementById("load-code");
        let update_code = document.getElementById("update-code");
        let sample_code = document.getElementById("sample-code");

        let change_tab = function(el) {
            if(el.className != "selected") {
                document.querySelector(".selected").className = "";
                el.className = "selected";
            }
        }

        let download_file = function(id, filename) {
            let el = document.createElement("a");
            let editor = document.getElementById(id);
            el.setAttribute("href", "data:text/plain;charset=utf-8," + encodeURIComponent(editor.value));
            el.setAttribute("download", filename);
            el.style.display = "none";
            document.body.appendChild(el);
            el.click();
            document.body.removeChild(el);
        }

        let example_codes = {
            "Simple sample": [
                [ "" ],
                [
                    "{>309}         move 309 cells to the right",
                    "[-]            clear the main cell",
                    ">              move to 'temp' cell",
                    "++++,          get the input value of the 'A' key (id of 4)",
                    "[              if up arrow is being pressed (value of 1)",
                    "    < ++++     move and quadruple value from",
                    "    > -        2nd cell to the 1st cell",
                    "]",
                    ".              update canvas"
                ]
            ],
            "Happy face, sad face": [
                [ "" ],
                [
                    "{>157}(157)[-]  >    (158)[-]",
                    "{>26} (184)[-] {>26} (210)[-]",
                    "{>19} (229)[-]  >    (230)[-]",
                    "{>5}  (235)[-] {>25} (260)[-]",
                    "{>25} (285)[-] {>25} (310)[-]",
                    "{>19} (329)[-]  >    (330)[-]",
                    "{>5}  (335)[-] {>25} (360)[-]",
                    "{>24} (384)[-] {>23} (407)[-]",
                    " >    (408)[-] {<408}(  0)[-]",
                    "",
                    "{>160}(160)[-]  >    (161)[-]",
                    "{>23} (184)[-] {>24} (208)[-]",
                    "{>21} (229)[-]  >    (230)[-]",
                    "{>3}  (233)[-] {>25} (258)[-]",
                    "{>25} (283)[-] {>25} (308)[-]",
                    "{>21} (329)[-]  >    (330)[-]",
                    "{>3}  (333)[-] {>25} (358)[-]",
                    "{>26} (384)[-] {>26} (410)[-]",
                    " >    (411)[-] {<411}(  0)[-]",
                    "{>500}+{<500}",
                    "",
                    "++++, [",
                    "    {>157}(157)[-]+   >    (158)[-]+",
                    "    {>26} (184)[-]+  {>26} (210)[-]+",
                    "    {>19} (229)[-]+   >    (230)[-]+",
                    "    {>5}  (235)[-]+  {>25} (260)[-]+",
                    "    {>25} (285)[-]+  {>25} (310)[-]+",
                    "    {>19} (329)[-]+   >    (330)[-]+",
                    "    {>5}  (335)[-]+  {>25} (360)[-]+",
                    "    {>24} (384)[-]+  {>23} (407)[-]+",
                    "     >    (408)[-]+  {<408}(  0)[-]",
                    "    {>500}[-]{<500}",
                    "]",
                    "{>500} [",
                    "    {<500}",
                    "    {>160}(160)[-]++  >    (161)[-]++",
                    "    {>23} (184)[-]++ {>24} (208)[-]++",
                    "    {>21} (229)[-]++  >    (230)[-]++",
                    "    {>3}  (233)[-]++ {>25} (258)[-]++",
                    "    {>25} (283)[-]++ {>25} (308)[-]++",
                    "    {>21} (329)[-]++  >    (330)[-]++",
                    "    {>3}  (333)[-]++ {>25} (358)[-]++",
                    "    {>26} (384)[-]++ {>26} (410)[-]++",
                    "     >    (411)[-]++ {<411}(  0)[-]",
                    "    {>500}[-]{<500}",
                    "]",
                    "."
                ]
            ]
        };

        for(let i in example_codes) {
            let el = document.createElement("button");
            el.className = "clickable";
            el.innerText = i;
            el.onclick= function(arg) {
                return function() {
                    let code = example_codes[arg];
                    let t, j;

                    t = "", j = 0;
                    while(j < code[0].length) t += code[0][j] + "\r\n", j++;
                    load_code.value = t.slice(0, -2) || "";
                    update_line_numbers(load_code, load_code.previousElementSibling);

                    t = "", j = 0;
                    while(j < code[1].length) t += code[1][j] + "\r\n", j++;
                    update_code.value = t.slice(0, -2) || "";
                    update_line_numbers(update_code, update_code.previousElementSibling);

                    set_text("status", "Loaded '" + arg + "'");
                }
            }(i);
            sample_code.appendChild(el);
        }
    </script>
    <script type="text/javascript" src="./brainfuck.js"></script>
</body>
</html>