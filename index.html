<!DOCTYPE html>
<html>
<html lang="en" manifest="bf.appcache">
    <meta charset="utf-8"/>
    <title> Counterintuitive yet Unique Brainfuck Engine </title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <style type="text/css">
        @import url(https://fonts.googleapis.com/css?family=Roboto);
        @import url(https://fonts.googleapis.com/css?family=Roboto+Mono);

        * {
            margin: 0;
            border: 0;
            padding: 0;
            outline: 0;
            font-size: 0;
            box-sizing: border-box;
            vertical-align: middle;
            list-style-type: none;
        }
        body {
            font-family: "Roboto", sans-serif;
            background-color: #efefef;
            overflow: hidden;
            width: 800px;
            height: 800px;
        }
        section {
            display: block;
            padding: 30px;
            text-align: center;
        }
        hr {
            height: 1px;
            background-color: #aeaeae;
            margin: 2px;
        }
        p, textarea {
            font-size: 16px;
        }
        textarea, #sample-code {
            font-family: "Roboto Mono", monospace;
            resize: none;
            width: 50%;
            border: 1px solid #aeaeae;
            padding: 15px 10px 10px;
            word-break: break-all;
            width: 100%;
            height: 600px;
            background-color: #fff;
        }
        button {
            cursor: pointer;
            user-select: none;
            border-radius: 1px;
            font-family: "Roboto", sans-serif;
            font-size: 16px;
            padding: 10px 20px;
            background-color: #b0ccff;
            box-shadow: 0 3px 0 cornflowerblue;
            transition: all .1s ease;
            margin: 5px;
        }
        button:active {
            transform: translateY(3px);
            box-shadow: 0 0px 0 cornflowerblue;
        }
        #run {
            margin: .5px;
        }
        span {
            font-size: 12px;
        }
        #status {
            font-size: 16px;
            font-family: "Roboto Mono", monospace;
            white-space: pre;
            padding: 15px;
            background-color: #cce;
            color: #333;
            height: 50px
        }
        #tabs {
            padding: 0;
            text-align: left;
        }
        #tabs > div {
            cursor: default;
            padding-left: 10px;
            border: 1px solid #aeaeae;
            display: inline-block;
            font-family: "Roboto Mono", monospace;
            width: 200px;
            color: #666;
            font-size: 16px;
            height: 50px;
            line-height: 50px;
            user-select: none;
            background-color: #f6f6f6;
            transform: translateY(1px);
            position: relative;
        }
        #tabs > div:not(:last-of-type) {
            border-right: 0;
        }
        #tabs > div.selected {
            border-bottom: 0;
            color: #333;
            background-color: #fff;
        }
        [data-id] ~ [data-id], #dl-guide {
            display: none;
        }
        [data-id="1"].selected ~ [data-id="1"],
        [data-id="2"].selected ~ [data-id="2"],
        [data-id="3"].selected ~ [data-id="3"] {
            display: block;
        }
        [data-id]:not(.selected) .download {
            pointer-events: none;
            opacity: .3;
        }
        .download {
            position: absolute;
            right: 10px;
            top: 13px;
            fill: #aeaeae;
            cursor: pointer;
            width: 24px;
        }
        .download:hover {
            fill: #333;
        }
    </style>
</head>
<body>
    <svg id="dl-guide" viewBox="0 0 24 24">
        <defs>
            <path id="dl" d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z" />
        </defs>
    </svg>
    <main>
        <section>
            <button id="run"> Run </button>
        </section>
        <div id="status"> Welcome to CUBE, the Counterintuitive yet Unique Brainfuck Engine </div>
        <section id="tabs">
            <div onclick="change_tab(this);" data-id="1" class="selected">
                load.bf
                <svg class="download" viewBox="0 0 24 24" onclick="download_file('load-code','load.bf');">
                    <use xlink:href="#dl"/>
                </svg>
            </div>
            <div onclick="change_tab(this);" data-id="2">
                update.bf
                <svg class="download" viewBox="0 0 24 24" onclick="download_file('update-code','update.bf');">
                    <use xlink:href="#dl"/>
                </svg>
            </div>
            <div onclick="change_tab(this);" data-id="3"> sample codes </div>
            <!-- -->
            <textarea
                id="load-code"
                data-id="1"
                spellcheck="false"
                placeholder="load.bf&#10;&#10;Code to be run upon startup.&#10;Runs only once."
            ></textarea>
            <textarea
                id="update-code"
                data-id="2"
                spellcheck="false"
                placeholder="update.bf&#10;&#10;Code to be run during the game.&#10;Runs on every frame."
            ></textarea>
            <section id="sample-code" data-id="3"></section>
        </section>
    </main>
    <script type="text/javascript">
        let tape = new Uint8Array(1e4);
        let load_code = document.getElementById("load-code");
        let update_code = document.getElementById("update-code");
        let sample_code = document.getElementById("sample-code");

        let change_tab = function(el) {
            if(el.className != "selected") {
                document.querySelector(".selected").className = "";
                el.className = "selected";
            }
        }

        let download_file = function(id, filename) {
            let el = document.createElement("a");
            let editor = document.getElementById(id);
            el.setAttribute("href", "data:text/plain;charset=utf-8," + encodeURIComponent(editor.value));
            el.setAttribute("download", filename);
            el.style.display = "none";
            document.body.appendChild(el);
            el.click();
            document.body.removeChild(el);
        }

        if("applicationCache" in window) {
            let appCache = window.applicationCache;
            if(appCache.status === 1 || appCache.status > 3) appCache.update();
            appCache.addEventListener("updateready", function(e) {
                if(appCache.status == appCache.UPDATEREADY) {
                    // Browser downloaded a new app cache.
                    console.info("new cache!");
                    appCache.swapCache();
                } else {
                    // Manifest didn't change.
                }
            }, false);
        }

        let example_codes = {
            "Simple sample":
`{>309}         move 309 cells to the right
[-]            clear the main cell
>              move to 'temp' cell
++++,          get the input value of the 'A' key (id of 4)
[              if up arrow is being pressed (value of 1)
    < ++++     move and quadruple value from
    > -        2nd cell to the 1st cell
]
.              update canvas`,
            "Happy face, sad face":
`{>157}(157)[-]  >    (158)[-]
{>26} (184)[-] {>26} (210)[-]
{>19} (229)[-]  >    (230)[-]
{>5}  (235)[-] {>25} (260)[-]
{>25} (285)[-] {>25} (310)[-]
{>19} (329)[-]  >    (330)[-]
{>5}  (335)[-] {>25} (360)[-]
{>24} (384)[-] {>23} (407)[-]
 >    (408)[-] {<408}(  0)[-]

{>160}(160)[-]  >    (161)[-]
{>23} (184)[-] {>24} (208)[-]
{>21} (229)[-]  >    (230)[-]
{>3}  (233)[-] {>25} (258)[-]
{>25} (283)[-] {>25} (308)[-]
{>21} (329)[-]  >    (330)[-]
{>3}  (333)[-] {>25} (358)[-]
{>26} (384)[-] {>26} (410)[-]
 >    (411)[-] {<411}(  0)[-]
{>500}+{<500}

++++, [
    {>157}(157)[-]+   >    (158)[-]+
    {>26} (184)[-]+  {>26} (210)[-]+
    {>19} (229)[-]+   >    (230)[-]+
    {>5}  (235)[-]+  {>25} (260)[-]+
    {>25} (285)[-]+  {>25} (310)[-]+
    {>19} (329)[-]+   >    (330)[-]+
    {>5}  (335)[-]+  {>25} (360)[-]+
    {>24} (384)[-]+  {>23} (407)[-]+
     >    (408)[-]+  {<408}(  0)[-]
    {>500}[-]{<500}
]
{>500} [
    {<500}
    {>160}(160)[-]++  >    (161)[-]++
    {>23} (184)[-]++ {>24} (208)[-]++
    {>21} (229)[-]++  >    (230)[-]++
    {>3}  (233)[-]++ {>25} (258)[-]++
    {>25} (283)[-]++ {>25} (308)[-]++
    {>21} (329)[-]++  >    (330)[-]++
    {>3}  (333)[-]++ {>25} (358)[-]++
    {>26} (384)[-]++ {>26} (410)[-]++
     >    (411)[-]++ {<411}(  0)[-]
    {>500}[-]{<500}
]
.`
        };
        for(let i in example_codes) {
            let el = document.createElement("button");
            el.innerText = i;
            el.onclick= function(arg) {
                return function() {
                    update_code.value = example_codes[arg];
                    set_text("status", "Loaded '" + arg + "'");
                }
            }(i);
            sample_code.appendChild(el);
        }
    </script>
    <script type="text/javascript" src="./brainfuck.js"></script>
</body>
</html>